!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):"object"==typeof exports?exports.Architect=t():e.Architect=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){var n,o,s,i,a,u,p=function(e,t){return function(){return e.apply(t,arguments)}};for(o={},a=["ajax","jsonp"],s=0,i=a.length;i>s;s++)u=a[s],o[u]=r(1)("./"+u+"_worker_polyfill");n=function(){function e(e){var t,r,n,o;t=null!=e?e:{},n=t.workersPath,o=t.workersSuffix,r=t.threads,this.handleMessage=p(this.handleMessage,this),this.jobs={},this.workers={},this.workersPath=n?"/"+n.replace(/^\//,""):"/workers",this.workersSuffix=o||"_worker.min.js"}return e.prototype.spawnWorker=function(e){return this.workersAreSupported()?new Worker(this.getWorkerPathForType(e)):this.getPolyfillForType(e)},e.prototype.getWorkerPathForType=function(e){return this.workersPath+"/"+e+this.workersSuffix},e.prototype.getPolyfillForType=function(e){var t;if(t=o[e],!t)throw new Error(e+" is not a valid type");return new t},e.prototype.workersAreSupported=function(e){return null==e&&(e=window),null!=this.workersSupported?this.workersSupported:this.workersSupported="Worker"in e},e.prototype.requireParams=function(e,t){var r,n,o,s,i,a,u,p,c;for(null==t&&(t={}),i=[],Array.isArray(e)||(e=[e]),r=0,o=e.length;o>r;r++)if(u=e[r],!(u in t))if((c=u.split(/\s?\|\|\s?/)).length>1){for(a=[],n=0,s=c.length;s>n;n++)p=c[n],p in t&&a.push(p);a.length||i.push(u)}else i.push(u);if(i.length)throw new Error("Missing required “"+i.join(", ")+"” parameter"+(i.length>1?"s":""))},e.prototype.getJobId=function(){return this.jobId||(this.jobId=1),this.jobId++},e.prototype.work=function(e){var t,r,n,o;return n=null!=e?e:{},t=n.data,o=n.type,r=n.path,this.requireParams("type || path",arguments[0]),new Promise(function(e){return function(n,s){var i,a;return i=e.getJobId(),e.jobs[i]={id:i,resolve:n,reject:s},(a=e.workers[o||r])||(a=o?e.spawnWorker(o):new Worker(r),a.addEventListener("message",e.handleMessage),e.workers[o||r]=a),a.postMessage({id:i,args:t})}}(this))},e.prototype.handleMessage=function(e){var t,r,n,o,s;return n=e.data,t=n.id,s=n.resolve,o=n.reject,r=this.jobs[t],delete this.jobs[t],"resolve"in e.data?r.resolve(s):r.reject(o)},e.prototype.jsonp=function(e){return null==e&&(e={}),"string"==typeof e&&(e={url:e}),this.requireParams("url",e),this.work({data:e,type:"jsonp"})},e.prototype.ajax=function(e){var t,r,n;return null==e&&(e={}),this.requireParams("url",e),n=e.success,t=e.error,r=JSON.parse(JSON.stringify(e)),delete r.success,delete r.error,new Promise(function(e){return function(o,s){return e.work({data:r,type:"ajax"}).then(function(e){return o(e),"function"==typeof n?n(e):void 0})["catch"](function(e){return s(e),"function"==typeof t?t(e):void 0})}}(this))},e.prototype.custom=function(e){var t,r,n,o;return o=null!=e?e:{},n=o.path,t=o.data,r=o.fallback,this.requireParams("path",arguments[0]),new Promise(function(e){return function(o,s){return e.workersAreSupported()?e.work({data:t,path:n}).then(o):r?o(r(t)):s("Workers not supported and fallback not provided for "+n)}}(this))},e}(),e.exports=n},function(e,t,r){function n(e){return r(o(e))}function o(e){return s[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var s={"./ajax_worker_polyfill":2,"./jsonp_worker_polyfill":3};n.keys=function(){return Object.keys(s)},n.resolve=o,e.exports=n,n.id=1},function(e,t,r){var n,o,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},i={}.hasOwnProperty;o=r(4),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.handleSuccess=function(e,t){return this.handleRequest({id:e,resolve:t})},t.prototype.handleError=function(e,t){return this.handleRequest({id:e,reject:t})},t.prototype.postMessage=function(e){var t,r,n,o,s,i,a,u,p,c,l;u=e.id,t=e.args,p=t.type,c=t.url,n=t.data,o=t.dataType,r=t.contentType,a=t.headers,p||(p="GET"),a||(a={}),null==a["X-Requested-With"]&&(a["X-Requested-With"]="XMLHttpRequest"),r!==!1&&(a["Content-Type"]=r||"application/x-www-form-urlencoded"),l=new XMLHttpRequest,l.open(p,c),"withCredentials"in t&&(l.withCredentials=t.withCredentials);for(s in a)i=a[s],i&&l.setRequestHeader(s,i);return l.onreadystatechange=function(e){return function(){var t,r;if(4===l.readyState){if(l.status>=200&&l.status<300||304===l.status){r=l.responseText;try{"script"===o?(1,eval)(r):"xml"===o?r=l.responseXML:"json"===o&&(r=/^\s*$/.test(r)?null:JSON.parse(r))}catch(n){t=n}return t?e.handleError(u,l):e.handleSuccess(u,r)}return e.handleError(u,l)}}}(this),l.send(n)},t}(o),e.exports=n},function(e,t,r){var n,o,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},i={}.hasOwnProperty,a=[].slice;o=r(4),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.postMessage=function(e){var t,r,n,o,s,i;return o=e.id,t=e.args,i=t.url,r=t.callbackAttribute,n=t.callbackFnName,void 0===r&&(r="callback"),void 0===n&&(this.jsonpID||(this.jsonpID=0),n="architect_jsonp"+ ++this.jsonpID),window[n]=function(e){return function(){var t;return t=1<=arguments.length?a.call(arguments,0):[],delete window[n],e.removeScript(),t=t.length>1?t:t[0],e.handleRequest({id:o,resolve:t})}}(this),s=r?this.appendQuery(i,r+"="+n):i,this.addScript(s)},t.prototype.addScript=function(e){return this.tmpScript=document.createElement("script"),this.tmpScript.src=e,document.head.appendChild(this.tmpScript)},t.prototype.removeScript=function(){return document.head.removeChild(this.tmpScript)},t.prototype.appendQuery=function(e,t){return(e+"&"+t).replace(/[&?]{1,2}/,"?")},t}(o),e.exports=n},function(e){var t;t=function(){function e(){this.callbacks={},this.callbacksQueue={}}return e.prototype.addEventListener=function(e,t){var r;return this.callbacks[e]=t,(r=this.callbacksQueue[e])?(delete this.callbacksQueue[e],this.dispatch(e,r)):void 0},e.prototype.dispatch=function(e,t){return this.callbacks[e]?this.callbacks[e]({data:t}):this.callbacksQueue[e]=t},e.prototype.handleRequest=function(e){return this.dispatch("message",e)},e.prototype.postMessage=function(){},e.prototype.terminate=function(){},e}(),e.exports=t}])});