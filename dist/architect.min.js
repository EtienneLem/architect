!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.Architect=e():t.Architect=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){var n,o,s,i,a,u,p=function(t,e){return function(){return t.apply(e,arguments)}};for(o={},a=["ajax","jsonp"],s=0,i=a.length;i>s;s++)u=a[s],o[u]=r(1)("./"+u+"_worker_polyfill");n=function(){function t(t){var e,r,n,o;e=null!=t?t:{},n=e.workersPath,o=e.workersSuffix,r=e.threads,this.handleMessage=p(this.handleMessage,this),this.jobs={},this.workers={},this.workersPath=n?"/"+n.replace(/^\//,""):"/workers",this.workersSuffix=o||"_worker.min.js"}return t.prototype.spawnWorker=function(t){return this.workersAreSupported()?new Worker(this.getWorkerPathForType(t)):this.getPolyfillForType(t)},t.prototype.getWorkerPathForType=function(t){return this.workersPath+"/"+t+this.workersSuffix},t.prototype.getPolyfillForType=function(t){var e;if(e=o[t],!e)throw new Error(t+" is not a valid type");return new e},t.prototype.workersAreSupported=function(t){return null==t&&(t=window),null!=this.workersSupported?this.workersSupported:this.workersSupported="Worker"in t},t.prototype.requireParams=function(t,e){var r,n,o,s,i,a,u,p,c;for(null==e&&(e={}),i=[],Array.isArray(t)||(t=[t]),r=0,o=t.length;o>r;r++)if(u=t[r],!(u in e))if((c=u.split(/\s?\|\|\s?/)).length>1){for(a=[],n=0,s=c.length;s>n;n++)p=c[n],p in e&&a.push(p);a.length||i.push(u)}else i.push(u);if(i.length)throw new Error("Missing required “"+i.join(", ")+"” parameter"+(i.length>1?"s":""))},t.prototype.getJobId=function(){return this.jobId||(this.jobId=1),this.jobId++},t.prototype.work=function(t){var e,r,n,o;return n=null!=t?t:{},e=n.data,o=n.type,r=n.path,this.requireParams("type || path",arguments[0]),new Promise(function(t){return function(n,s){var i,a;return i=t.getJobId(),t.jobs[i]={id:i,resolve:n,reject:s},(a=t.workers[o||r])||(a=o?t.spawnWorker(o):new Worker(r),a.addEventListener("message",t.handleMessage),t.workers[o||r]=a),a.postMessage({id:i,args:e})}}(this))},t.prototype.handleMessage=function(t){var e,r,n,o,s;return n=t.data,e=n.id,s=n.resolve,o=n.reject,r=this.jobs[e],delete this.jobs[e],"resolve"in t.data?r.resolve(s):r.reject(o)},t.prototype.jsonp=function(t){return null==t&&(t={}),"string"==typeof t&&(t={url:t}),this.requireParams("url",t),this.work({data:t,type:"jsonp"})},t.prototype.ajax=function(t){var e,r,n;return null==t&&(t={}),this.requireParams("url",t),n=t.success,e=t.error,r=JSON.parse(JSON.stringify(t)),delete r.success,delete r.error,new Promise(function(t){return function(o,s){return t.work({data:r,type:"ajax"}).then(function(t){return o(t),"function"==typeof n?n(t):void 0})["catch"](function(t){return s(t),"function"==typeof e?e(t):void 0})}}(this))},t.prototype.custom=function(t){var e,r,n,o;return o=null!=t?t:{},n=o.path,e=o.data,r=o.fallback,this.requireParams("path",arguments[0]),new Promise(function(t){return function(o,s){return t.workersAreSupported()?t.work({data:e,path:n}).then(o):r?o(r(e)):s("Workers not supported and fallback not provided for "+n)}}(this))},t}(),t.exports=n},function(t,e,r){function n(t){return r(o(t))}function o(t){return s[t]||function(){throw new Error("Cannot find module '"+t+"'.")}()}var s={"./ajax_worker_polyfill":2,"./jsonp_worker_polyfill":3};n.keys=function(){return Object.keys(s)},n.resolve=o,t.exports=n,n.id=1},function(t,e,r){var n,o,s=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i={}.hasOwnProperty;o=r(4),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.handleSuccess=function(t){return this.handleRequest({success:t})},e.prototype.handleError=function(t){return this.handleRequest({error:t})},e.prototype.postMessage=function(t){var e,r,n,o,s,i,a,u,p,c,l;u=t.id,e=t.args,p=e.type,c=e.url,n=e.data,o=e.dataType,r=e.contentType,a=e.headers,p||(p="GET"),a||(a={}),null==a["X-Requested-With"]&&(a["X-Requested-With"]="XMLHttpRequest"),r!==!1&&(a["Content-Type"]=r||"application/x-www-form-urlencoded"),l=new XMLHttpRequest,l.open(p,c),"withCredentials"in e&&(l.withCredentials=e.withCredentials);for(s in a)i=a[s],i&&l.setRequestHeader(s,i);return l.onreadystatechange=function(t){return function(){var e,r;if(4===l.readyState){if(l.status>=200&&l.status<300||304===l.status){r=l.responseText;try{"script"===o?(1,eval)(r):"xml"===o?r=l.responseXML:"json"===o&&(r=/^\s*$/.test(r)?null:JSON.parse(r))}catch(n){e=n}return e?t.handleError(l):t.handleSuccess(r)}return t.handleError(l)}}}(this),l.send(n)},e}(o),t.exports=n},function(t,e,r){var n,o,s=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i={}.hasOwnProperty,a=[].slice;o=r(4),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.postMessage=function(t){var e,r,n,o,s,i;return o=t.id,e=t.args,i=e.url,r=e.callbackAttribute,n=e.callbackFnName,void 0===r&&(r="callback"),void 0===n&&(this.jsonpID||(this.jsonpID=0),n="architect_jsonp"+ ++this.jsonpID),window[n]=function(t){return function(){var e;return e=1<=arguments.length?a.call(arguments,0):[],delete window[n],t.removeScript(),e=e.length>1?e:e[0],t.handleRequest(e)}}(this),s=r?this.appendQuery(i,r+"="+n):i,this.addScript(s)},e.prototype.addScript=function(t){return this.tmpScript=document.createElement("script"),this.tmpScript.src=t,document.head.appendChild(this.tmpScript)},e.prototype.removeScript=function(){return document.head.removeChild(this.tmpScript)},e.prototype.appendQuery=function(t,e){return(t+"&"+e).replace(/[&?]{1,2}/,"?")},e}(o),t.exports=n},function(t){var e;e=function(){function t(){this.callbacks={},this.callbacksQueue={}}return t.prototype.addEventListener=function(t,e){var r;return this.callbacks[t]=e,(r=this.callbacksQueue[t])?(delete this.callbacksQueue[t],this.dispatch(t,r)):void 0},t.prototype.dispatch=function(t,e){return this.callbacks[t]?this.callbacks[t]({data:e}):this.callbacksQueue[t]=e},t.prototype.handleRequest=function(t){return this.dispatch("message",t)},t.prototype.postMessage=function(){},t.prototype.terminate=function(){},t}(),t.exports=e}])});