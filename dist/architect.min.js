!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.Architect=e():t.Architect=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){var n,o,s,u,i,a;for(o={},i=["ajax","jsonp"],s=0,u=i.length;u>s;s++)a=i[s],o[a]=r(1)("./"+a+"_worker_polyfill.coffee");n=function(){function t(t){var e,r,n,o;e=null!=t?t:{},n=e.workersPath,o=e.workersSuffix,r=e.threads,this.jobs={},this.queue=[],this.threads=r||5,this.workersPath=n?"/"+n.replace(/^\//,""):"/workers",this.workersSuffix=o||"_worker.min.js"}return t.prototype.spawnWorker=function(t){return this.workersAreSupported()?new Worker(this.getWorkersPathForType(t)):this.getPolyfillForType(t)},t.prototype.getWorkersPathForType=function(t){return this.workersPath+"/"+t+this.workersSuffix},t.prototype.getPolyfillForType=function(t){var e;if(e=o[t],!e)throw new Error(t+" is not a valid type");return new e},t.prototype.workersAreSupported=function(t){return null==t&&(t=window),null!=this.workersSupported?this.workersSupported:this.workersSupported="Worker"in t},t.prototype.requireParams=function(t,e){var r,n,o,s,u,i,a,p,c;for(null==e&&(e={}),u=[],Array.isArray(t)||(t=[t]),r=0,o=t.length;o>r;r++)if(a=t[r],!(a in e))if((c=a.split(/\s?\|\|\s?/)).length>1){for(i=[],n=0,s=c.length;s>n;n++)p=c[n],p in e&&i.push(p);i.length||u.push(a)}else u.push(a);if(u.length)throw new Error("Missing required “"+u.join(", ")+"” parameter"+(u.length>1?"s":""))},t.prototype.getJobId=function(){return this.jobId||(this.jobId=1),this.jobId++},t.prototype.work=function(t){var e,r,n,o,s;return n=null!=t?t:{},e=n.data,o=n.type,s=n.worker,this.requireParams("type || worker",arguments[0]),r=this.getJobId(),new Promise(function(t){return function(n){return t.enqueue(r).then(function(){return t.jobs[r]=s||(s=t.spawnWorker(o)),s.postMessage(e),s.addEventListener("message",function(e){return t.clearJob(r),s.terminate(),n(e.data)})})}}(this))},t.prototype.jsonp=function(t){return null==t&&(t={}),"string"==typeof t&&(t={url:t}),this.requireParams("url",t),this.work({data:t,type:"jsonp"})},t.prototype.ajax=function(t){var e,r,n;return null==t&&(t={}),this.requireParams("url",t),n=t.success,e=t.error,r=JSON.parse(JSON.stringify(t)),delete r.success,delete r.error,new Promise(function(t){return function(o,s){return t.work({data:r,type:"ajax"}).then(function(t){return"success"in t?(o(t.success),"function"==typeof n?n(t.success):void 0):"error"in t?(s(t.error),"function"==typeof e?e(t.error):void 0):void 0})}}(this))},t.prototype.custom=function(t){var e,r,n,o;return o=null!=t?t:{},n=o.path,e=o.data,r=o.fallback,this.requireParams("path",arguments[0]),new Promise(function(t){return function(o,s){var u;return t.workersAreSupported()?(u=new Worker(n),t.work({data:e,worker:u}).then(o)):r?o(r(e)):s("Workers not supported and fallback not provided for "+n)}}(this))},t.prototype.enqueue=function(){return new Promise(function(t){return function(e){return setTimeout(function(){return Object.keys(t.jobs).length<t.threads?e():t.queue.push({resolve:e})},0)}}(this))},t.prototype.clearJob=function(t){var e;return delete this.jobs[t],this.queue.length?(e=this.queue.shift(),e.resolve()):void 0},t}(),t.exports=n},function(t,e,r){function n(t){return r(o(t))}function o(t){return s[t]||function(){throw new Error("Cannot find module '"+t+"'.")}()}var s={"./ajax_worker_polyfill.coffee":2,"./jsonp_worker_polyfill.coffee":3};n.keys=function(){return Object.keys(s)},n.resolve=o,t.exports=n,n.id=1},function(t,e,r){var n,o,s=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},u={}.hasOwnProperty;o=r(4),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.handleSuccess=function(t){return this.handleRequest({success:t})},e.prototype.handleError=function(t){return this.handleRequest({error:t})},e.prototype.postMessage=function(t){var e,r,n,o,s,u,i,a,p;u=t,i=u.type,a=u.url,t=u.data,r=u.dataType,e=u.contentType,s=u.headers,i||(i="GET"),s||(s={}),s["X-Requested-With"]="XMLHttpRequest",e!==!1&&(s["Content-Type"]=e||"application/x-www-form-urlencoded"),p=new XMLHttpRequest,p.open(i,a);for(n in s)o=s[n],p.setRequestHeader(n,o);return p.onreadystatechange=function(t){return function(){var e,n;if(4===p.readyState){if(p.status>=200&&p.status<300||304===p.status){n=p.responseText;try{"script"===r?(1,eval)(n):"xml"===r?n=p.responseXML:"json"===r&&(n=/^\s*$/.test(n)?null:JSON.parse(n))}catch(o){e=o}return e?t.handleError(p):t.handleSuccess(n)}return t.handleError(p)}}}(this),p.send(t)},e}(o),t.exports=n},function(t,e,r){var n,o,s=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},u={}.hasOwnProperty,i=[].slice;o=r(4),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.postMessage=function(t){var e,r,n,o;return o=t.url,e=t.callbackAttribute,r=t.callbackFnName,void 0===e&&(e="callback"),void 0===r&&(this.jsonpID||(this.jsonpID=0),r="architect_jsonp"+ ++this.jsonpID),window[r]=function(t){return function(){var e;return e=1<=arguments.length?i.call(arguments,0):[],delete window[r],t.removeScript(),e=e.length>1?e:e[0],t.handleRequest(e)}}(this),n=e?this.appendQuery(o,e+"="+r):o,this.addScript(n)},e.prototype.addScript=function(t){return this.tmpScript=document.createElement("script"),this.tmpScript.src=t,document.head.appendChild(this.tmpScript)},e.prototype.removeScript=function(){return document.head.removeChild(this.tmpScript)},e.prototype.appendQuery=function(t,e){return(t+"&"+e).replace(/[&?]{1,2}/,"?")},e}(o),t.exports=n},function(t){var e;e=function(){function t(){this.callbacks={},this.callbacksQueue={}}return t.prototype.addEventListener=function(t,e){var r;return this.callbacks[t]=e,(r=this.callbacksQueue[t])?(delete this.callbacksQueue[t],this.dispatch(t,r)):void 0},t.prototype.dispatch=function(t,e){return this.callbacks[t]?this.callbacks[t]({data:e}):this.callbacksQueue[t]=e},t.prototype.handleRequest=function(t){return this.dispatch("message",t)},t.prototype.postMessage=function(){},t.prototype.terminate=function(){},t}(),t.exports=e}])});