!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.Architect=e():t.Architect=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){var n,o,s,u,a,p;for(o={},a=["ajax","jsonp"],s=0,u=a.length;u>s;s++)p=a[s],o[p]=r(1)("./"+p+"_worker_polyfill.coffee");n=function(){function t(t){var e,r,n;e=null!=t?t:{},r=e.workersPath,n=e.workersSuffix,this.jobs={},this.workersPath=r||"/workers",this.workersSuffix=n||"_worker.min.js"}return t.prototype.spawnWorker=function(t){return this.workersAreSupported()?new Worker(this.getWorkersPathForType(t)):this.getPolyfillForType(t)},t.prototype.getWorkersPathForType=function(t){return this.workersPath+"/"+t+this.workersSuffix},t.prototype.getPolyfillForType=function(t){return new o[t]},t.prototype.workersAreSupported=function(){return null!=this.workersSupported?this.workersSupported:this.workersSupported=!!window.Worker},t.prototype.work=function(t){var e,r,n;return e=t.data,r=t.type,n=t.worker,new Promise(function(t){return function(o){return n||(n=t.spawnWorker(r)),n.postMessage(e),n.addEventListener("message",function(t){return n.terminate(),o(t.data)})}}(this))},t.prototype.jsonp=function(t){return"string"==typeof t&&(t={url:t}),this.work({data:t,type:"jsonp"})},t.prototype.ajax=function(t){var e,r;return r=t.success,e=t.error,delete t.success,delete t.error,new Promise(function(n){return function(o,s){return n.work({data:t,type:"ajax"}).then(function(t){return"success"in t?(o(t.success),"function"==typeof r?r(t.success):void 0):"error"in t?(s(t.error),"function"==typeof e?e(t.error):void 0):void 0})}}(this))},t.prototype.custom=function(t){var e,r,n;return n=t.path,e=t.data,r=t.fallback,new Promise(function(t){return function(o,s){var u;return t.workersAreSupported()?(u=new Worker(n),t.work({data:e,worker:u}).then(o)):r?o(r(e)):s("Workers not supported and fallback not provided for "+n)}}(this))},t}(),t.exports=n},function(t,e,r){function n(t){return r(o(t))}function o(t){return s[t]||function(){throw new Error("Cannot find module '"+t+"'.")}()}var s={"./ajax_worker_polyfill.coffee":2,"./jsonp_worker_polyfill.coffee":3};n.keys=function(){return Object.keys(s)},n.resolve=o,t.exports=n,n.id=1},function(t,e,r){var n,o,s=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},u={}.hasOwnProperty;o=r(4),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.handleSuccess=function(t){return this.handleRequest({success:t})},e.prototype.handleError=function(t){return this.handleRequest({error:t})},e.prototype.postMessage=function(t){var e,r,n,o,s,u,a,p,i;u=t,a=u.type,p=u.url,t=u.data,r=u.dataType,e=u.contentType,s=u.headers,a||(a="GET"),s||(s={}),s["X-Requested-With"]="XMLHttpRequest",e!==!1&&(s["Content-Type"]=e||"application/x-www-form-urlencoded"),i=new XMLHttpRequest,i.open(a,p);for(n in s)o=s[n],i.setRequestHeader(n,o);return i.onreadystatechange=function(t){return function(){var e,n;if(4===i.readyState){if(i.status>=200&&i.status<300||304===i.status){n=i.responseText;try{"script"===r?(1,eval)(n):"xml"===r?n=i.responseXML:"json"===r&&(n=/^\s*$/.test(n)?null:JSON.parse(n))}catch(o){e=o}return e?t.handleError(i):t.handleSuccess(n)}return t.handleError(i)}}}(this),i.send(t)},e}(o),t.exports=n},function(t,e,r){var n,o,s=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},u={}.hasOwnProperty,a=[].slice;o=r(4),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.postMessage=function(t){var e,r,n,o;return o=t.url,e=t.callbackAttribute,r=t.callbackFnName,void 0===e&&(e="callback"),void 0===r&&(this.jsonpID||(this.jsonpID=0),r="architect_jsonp"+ ++this.jsonpID),window[r]=function(t){return function(){var e;return e=1<=arguments.length?a.call(arguments,0):[],delete window[r],t.removeScript(),e=e.length>1?e:e[0],t.handleRequest(e)}}(this),n=e?this.appendQuery(o,e+"="+r):o,this.addScript(n)},e.prototype.addScript=function(t){return this.tmpScript=document.createElement("script"),this.tmpScript.src=t,document.head.appendChild(this.tmpScript)},e.prototype.removeScript=function(){return document.head.removeChild(this.tmpScript)},e.prototype.appendQuery=function(t,e){return(t+"&"+e).replace(/[&?]{1,2}/,"?")},e}(o),t.exports=n},function(t){var e;e=function(){function t(){this.callbacks={},this.callbacksQueue={}}return t.prototype.addEventListener=function(t,e){var r;return this.callbacks[t]=e,(r=this.callbacksQueue[t])?(delete this.callbacksQueue[t],this.dispatch(t,r)):void 0},t.prototype.dispatch=function(t,e){return this.callbacks[t]?this.callbacks[t]({data:e}):this.callbacksQueue[t]=e},t.prototype.handleRequest=function(t){return this.dispatch("message",t)},t.prototype.postMessage=function(){},t.prototype.terminate=function(){},t}(),t.exports=e}])});