!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Architect=e():t.Architect=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){var n,o,s,a,i,u,p=function(t,e){return function(){return t.apply(e,arguments)}};for(o={},i=["ajax","jsonp"],s=0,a=i.length;a>s;s++)u=i[s],o[u]=r(1)("./"+u+"_worker_polyfill");n=function(){function t(t){var e,r,n,o;e=null!=t?t:{},n=e.workersPath,o=e.workersSuffix,r=e.threads,this.handleMessage=p(this.handleMessage,this),this.jobs={},this.workers={},this.workersPath=n?"/"+n.replace(/^\//,""):"/workers",this.workersSuffix=o||"_worker.min.js"}return t.prototype.spawnWorker=function(t){return this.workersAreSupported()?new Worker(this.getWorkerPathForType(t)):this.getPolyfillForType(t)},t.prototype.getWorkerPathForType=function(t){return this.workersPath+"/"+t+this.workersSuffix},t.prototype.getPolyfillForType=function(t){var e;if(e=o[t],!e)throw new Error(t+" is not a valid type");return new e},t.prototype.workersAreSupported=function(t){return null==t&&(t=window),null!=this.workersSupported?this.workersSupported:this.workersSupported="Worker"in t},t.prototype.requireParams=function(t,e){var r,n,o,s,a,i,u,p,c;for(null==e&&(e={}),a=[],Array.isArray(t)||(t=[t]),r=0,o=t.length;o>r;r++)if(u=t[r],!(u in e))if((c=u.split(/\s?\|\|\s?/)).length>1){for(i=[],n=0,s=c.length;s>n;n++)p=c[n],p in e&&i.push(p);i.length||a.push(u)}else a.push(u);if(a.length)throw new Error("Missing required “"+a.join(", ")+"” parameter"+(a.length>1?"s":""))},t.prototype.getJobId=function(){return this.jobId||(this.jobId=1),this.jobId++},t.prototype.work=function(t){var e,r,n,o;return n=null!=t?t:{},e=n.data,o=n.type,r=n.path,this.requireParams("type || path",arguments[0]),new Promise(function(t){return function(n,s){var a,i;return a=t.getJobId(),t.jobs[a]={id:a,resolve:n,reject:s},(i=t.workers[o||r])||(i=o?t.spawnWorker(o):new Worker(r),i.addEventListener("message",t.handleMessage),t.workers[o||r]=i),i.postMessage({id:a,args:e})}}(this))},t.prototype.handleMessage=function(t){var e,r,n,o,s;return n=t.data,e=n.id,s=n.resolve,o=n.reject,r=this.jobs[e],delete this.jobs[e],"resolve"in t.data?r.resolve(s):r.reject(o)},t.prototype.jsonp=function(t){return null==t&&(t={}),"string"==typeof t&&(t={url:t}),this.requireParams("url",t),this.work({data:t,type:"jsonp"})},t.prototype.ajax=function(t){var e,r,n;return null==t&&(t={}),this.requireParams("url",t),n=t.success,e=t.error,r=JSON.parse(JSON.stringify(t)),delete r.success,delete r.error,new Promise(function(t){return function(o,s){return t.work({data:r,type:"ajax"}).then(function(t){return o(t),"function"==typeof n?n(t):void 0})["catch"](function(t){return s(t),"function"==typeof e?e(t):void 0})}}(this))},t.prototype.custom=function(t){var e,r,n,o;return o=null!=t?t:{},n=o.path,e=o.data,r=o.fallback,this.requireParams("path",arguments[0]),new Promise(function(t){return function(o,s){return t.workersAreSupported()?t.work({data:e,path:n}).then(o):r?o(r(e)):s("Workers not supported and fallback not provided for "+n)}}(this))},t}(),t.exports=n},function(t,e,r){function n(t){return r(o(t))}function o(t){return s[t]||function(){throw new Error("Cannot find module '"+t+"'.")}()}var s={"./ajax_worker_polyfill":2,"./jsonp_worker_polyfill":4};n.keys=function(){return Object.keys(s)},n.resolve=o,t.exports=n,n.id=1},function(t,e,r){var n,o,s=function(t,e){function r(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},a={}.hasOwnProperty;o=r(3),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.handleSuccess=function(t){return this.handleRequest({success:t})},e.prototype.handleError=function(t){return this.handleRequest({error:t})},e.prototype.postMessage=function(t){var e,r,n,o,s,a,i,u,p;a=t,i=a.type,u=a.url,t=a.data,r=a.dataType,e=a.contentType,s=a.headers,i||(i="GET"),s||(s={}),null==s["X-Requested-With"]&&(s["X-Requested-With"]="XMLHttpRequest"),e!==!1&&(s["Content-Type"]=e||"application/x-www-form-urlencoded"),p=new XMLHttpRequest,p.open(i,u),"withCredentials"in args&&(p.withCredentials=args.withCredentials);for(n in s)o=s[n],o&&p.setRequestHeader(n,o);return p.onreadystatechange=function(t){return function(e){var n,o;if(4===p.readyState){if(p.status>=200&&p.status<300||304===p.status){o=p.responseText;try{"script"===r?(1,eval)(o):"xml"===r?o=p.responseXML:"json"===r&&(o=/^\s*$/.test(o)?null:JSON.parse(o))}catch(s){n=s}return n?t.handleError(p):t.handleSuccess(o)}return t.handleError(p)}}}(this),p.send(t)},e}(o),t.exports=n},function(t,e){var r;r=function(){function t(){this.callbacks={},this.callbacksQueue={}}return t.prototype.addEventListener=function(t,e){var r;return this.callbacks[t]=e,(r=this.callbacksQueue[t])?(delete this.callbacksQueue[t],this.dispatch(t,r)):void 0},t.prototype.dispatch=function(t,e){return this.callbacks[t]?this.callbacks[t]({data:e}):this.callbacksQueue[t]=e},t.prototype.handleRequest=function(t){return this.dispatch("message",t)},t.prototype.postMessage=function(){},t.prototype.terminate=function(){},t}(),t.exports=r},function(t,e,r){var n,o,s=function(t,e){function r(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},a={}.hasOwnProperty,i=[].slice;o=r(3),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.postMessage=function(t){var e,r,n,o;return o=t.url,e=t.callbackAttribute,r=t.callbackFnName,void 0===e&&(e="callback"),void 0===r&&(this.jsonpID||(this.jsonpID=0),r="architect_jsonp"+ ++this.jsonpID),window[r]=function(t){return function(){var e;return e=1<=arguments.length?i.call(arguments,0):[],delete window[r],t.removeScript(),e=e.length>1?e:e[0],t.handleRequest(e)}}(this),n=e?this.appendQuery(o,e+"="+r):o,this.addScript(n)},e.prototype.addScript=function(t){return this.tmpScript=document.createElement("script"),this.tmpScript.src=t,document.head.appendChild(this.tmpScript)},e.prototype.removeScript=function(){return document.head.removeChild(this.tmpScript)},e.prototype.appendQuery=function(t,e){return(t+"&"+e).replace(/[&?]{1,2}/,"?")},e}(o),t.exports=n}])});