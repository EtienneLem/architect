!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Architect=t():e.Architect=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var s=r[n]={exports:{},id:n,loaded:!1};return e[n].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){var n,s=function(e,t){return function(){return e.apply(t,arguments)}};n=function(){function e(){this.handleMessage=s(this.handleMessage,this),this.jobs={},this.workers={native:{},polyfill:{}}}return e.prototype.spawnWorker=function(e){var t,n,s,o,i,u,a,c,l,p,f,d;c=null!=e?e:{},l=c.type,o=c.data,u=c.fn,p=c.usePolyfill;try{f=r(1)("./"+l)}catch(e){if(i=e,!u)throw new Error("Unkown worker type “"+l+"” and no fn provided");f=r(3)}return!p&&this.workersAreSupported()?(a=u?"work = "+u.toString()+";":"",d="("+f.toString()+")()",n=new Blob([a,d]),s=window.URL.createObjectURL(n),new Worker(s)):new(t=r(5))(f,u)},e.prototype.workersAreSupported=function(e){return null==e&&(e=window),null!=this.workersSupported?this.workersSupported:this.workersSupported="Worker"in e},e.prototype.requireParams=function(e,t){var r,n,s,o,i,u,a,c,l;for(null==t&&(t={}),i=[],Array.isArray(e)||(e=[e]),r=0,s=e.length;r<s;r++)if(a=e[r],!(a in t))if((l=a.split(/\s?\|\|\s?/)).length>1){for(u=[],n=0,o=l.length;n<o;n++)c=l[n],c in t&&u.push(c);u.length||i.push(a)}else i.push(a);if(i.length)throw new Error("Missing required “"+i.join(", ")+"” parameter"+(i.length>1?"s":""))},e.prototype.getJobId=function(){return this.jobId||(this.jobId=1),this.jobId++},e.prototype.work=function(e){var t,r,n,s,o;return n=null!=e?e:{},s=n.type,t=n.data,r=n.fn,o=n.usePolyfill,this.requireParams("type",arguments[0]),new Promise(function(e){return function(n,i){var u,a,c;return u=e.getJobId(),e.jobs[u]={id:u,resolve:n,reject:i},a=o||!e.workersAreSupported()?"polyfill":"native",(c=e.workers[a][s])||(c=e.spawnWorker({type:s,data:t,fn:r,usePolyfill:o}),c.addEventListener("message",e.handleMessage),e.workers[a][s]=c),c.postMessage({id:u,args:t})}}(this))},e.prototype.handleMessage=function(e){var t,r,n,s,o;return n=e.data,t=n.id,o=n.resolve,s=n.reject,r=this.jobs[t],delete this.jobs[t],"resolve"in e.data?r.resolve(o):r.reject(s)},e.prototype.jsonp=function(e,t){var r;return null==e&&(e={}),r=(null!=t?t:{}).usePolyfill,"string"==typeof e&&(e={url:e}),this.requireParams("url",e),this.work({data:e,type:"jsonp",usePolyfill:r})},e.prototype.ajax=function(e,t){var r,n,s,o;return null==e&&(e={}),o=(null!=t?t:{}).usePolyfill,this.requireParams("url",e),s=e.success,r=e.error,n=JSON.parse(JSON.stringify(e)),delete n.success,delete n.error,new Promise(function(e){return function(t,i){return e.work({data:n,type:"ajax",usePolyfill:o}).then(function(e){return t(e),"function"==typeof s?s(e):void 0}).catch(function(e){return i(e),"function"==typeof r?r(e):void 0})}}(this))},e}(),e.exports=n},function(e,t,r){function n(e){return r(s(e))}function s(e){return o[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var o={"./ajax":2,"./ajax.coffee":2,"./custom":3,"./custom.coffee":3,"./jsonp":4,"./jsonp.coffee":4,"./polyfill":5,"./polyfill.coffee":5};n.keys=function(){return Object.keys(o)},n.resolve=s,e.exports=n,n.id=1},function(e,t){e.exports=function(){var e,t;return t=function(e){return function(t,r){return e.postMessage({id:t,resolve:r})}}(this),e=function(e){return function(t,r,n){var s,o,i,u,a,c,l;for(l={},a=["response","responseType","responseText","responseXML","responseURL","status","statusText","withCredentials","readyState","timeout"],o=0,u=a.length;o<u;o++)i=a[o],l[i]=r[i];try{"json"===n&&(c=l.response,l.response=/^\s*$/.test(c)?null:JSON.parse(c))}catch(e){s=e}return e.postMessage({id:t,reject:l})}}(this),this.onmessage=function(r){var n,s,o,i,u,a,c,l,p,f,d,h;p=r.data,l=p.id,n=p.args,f=n.type,d=n.url,o=n.data,i=n.dataType,s=n.contentType,c=n.headers,f||(f="GET"),c||(c={}),null==c["X-Requested-With"]&&(c["X-Requested-With"]="XMLHttpRequest"),s!==!1&&(c["Content-Type"]=s||"application/x-www-form-urlencoded"),h=new XMLHttpRequest,h.open(f,d),"withCredentials"in n&&(h.withCredentials=n.withCredentials);for(u in c)a=c[u],a&&h.setRequestHeader(u,a);return h.onreadystatechange=function(r){var n,s;if(4===h.readyState){if(h.status>=200&&h.status<300||304===h.status){s=h.responseText;try{"script"===i?(0,eval)(s):"xml"===i?s=h.responseXML:"json"===i&&(s=/^\s*$/.test(s)?null:JSON.parse(s))}catch(e){n=e}return n?e(l,h,i):t(l,s)}return e(l,h,i)}},h.send(o)}}},function(module,exports){module.exports=function(){return this.onmessage=function(_this){return function(e){var args,id,ref,result;return ref=e.data,id=ref.id,args=ref.args,_this.fn?("string"==typeof _this.fn&&(_this.fn=eval("this._fn = "+_this.fn)),result=_this.fn(args)):result=work(args),result instanceof Promise?result.then(function(e){return _this.postMessage({id:id,resolve:e})}).catch(function(e){return _this.postMessage({id:id,reject:e})}):_this.postMessage({id:id,resolve:result})}}(this)}},function(e,t){var r;r=self,e.exports=function(){var e;return e=function(e,t){return(e+"&"+t).replace(/[&?]{1,2}/,"?")},this.onmessage=function(t){var n,s,o,i,u,a,c,l,p;a=t.data,u=a.id,n=a.args,p=n.url,s=n.callbackAttribute,o=n.callbackFnName,void 0===s&&(s="callback"),void 0===o&&(o="handleRequest_"+u),l=s?e(p,s+"="+o):p,"undefined"==typeof r&&(r=self),r[o]=function(e){return function(){return delete r[o],"function"==typeof e.removeScripts&&e.removeScripts(l),n=[].slice.call(arguments),n=n.length>1?n:n[0],e.postMessage({id:u,resolve:n})}}(this);try{return null!=(c=this.importScripts(l))?c.catch(function(e){return function(t){return e.postMessage({id:u,reject:t})}}(this)):void 0}catch(e){return i=e,this.postMessage({id:u,reject:{message:i.message,code:i.code,name:i.name}})}}}},function(e,t){var r;r=function(){function e(e,t){this.fn=t,this.jobs={},this.scripts={},this.callbacks={},this.callbacksQueue={},e.call(this)}return e.prototype.addEventListener=function(e,t){var r;if(this.callbacks[e]=t,r=this.callbacksQueue[e])return delete this.callbacksQueue[e],this.dispatch(e,r)},e.prototype.dispatch=function(e,t){return this.callbacks[e]?this.callbacks[e]({data:t}):this.callbacksQueue[e]=t},e.prototype.handleRequest=function(e){return this.dispatch("message",e)},e.prototype.postMessage=function(e){return this.jobs[e.id]?this.dispatch("message",e):(this.jobs[e.id]=e,this.onmessage({data:e}))},e.prototype.importScripts=function(e){return new Promise(function(t){return function(r,n){var s;return s=document.createElement("script"),s.src=e,s.crossorigin="anonymous",s.onerror=n,document.head.appendChild(s),t.scripts[e]=s}}(this))},e.prototype.removeScripts=function(e){var t;if(t=this.scripts[e])return delete this.scripts[e],document.head.removeChild(t)},e.prototype.terminate=function(){},e}(),e.exports=r}])});