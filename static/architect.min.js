/*
* Architect v0.2.0
* http://architectjs.org
*
* Copyright 2013, Etienne Lemay http://heliom.ca
* Released under the MIT license
*/
(function(){this.Architect={},this.Architect.VERSION="0.2.0"}).call(this),function(){this.Architect.Worker=function(){function t(){this.callbacks={},this.callbacksQueue={}}return t.prototype.addEventListener=function(t,r){var e;return this.callbacks[t]=r,(e=this.callbacksQueue[t])?(delete this.callbacksQueue[t],this.dispatch(t,e)):void 0},t.prototype.dispatch=function(t,r){return this.callbacks[t]?this.callbacks[t]({data:r}):this.callbacksQueue[t]=r},t.prototype.handleRequest=function(t){return this.dispatch("message",t)},t.prototype.terminate=function(){},t}()}.call(this),function(){var t={}.hasOwnProperty,r=function(r,e){function n(){this.constructor=r}for(var o in e)t.call(e,o)&&(r[o]=e[o]);return n.prototype=e.prototype,r.prototype=new n,r.__super__=e.prototype,r};this.Architect.AjaxWorker=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return r(n,t),n.prototype.handleSuccess=function(t){return this.handleRequest({success:t})},n.prototype.handleError=function(t){return this.handleRequest({error:t})},n.prototype.postMessage=function(){var t,r,n,o,c,i,s,u,a,h;h=e.data,s=h.type,u=h.url,r=h.data,n=h.dataType,t=h.contentType,i=h.headers,s||(s="GET"),i||(i={}),i["X-Requested-With"]="XMLHttpRequest",t!==!1&&(i["Content-Type"]=t||"application/x-www-form-urlencoded"),a=new XMLHttpRequest,a.open(s,u);for(o in i)c=i[o],a.setRequestHeader(o,c);return a.onreadystatechange=function(t){return function(){var r,e;if(4===a.readyState){if(a.status>=200&&a.status<300||304===a.status){e=a.responseText;try{"script"===n?(1,eval)(e):"xml"===n?e=a.responseXML:"json"===n&&(e=/^\s*$/.test(e)?null:JSON.parse(e))}catch(o){r=o}return r?t.handleError(a):t.handleSuccess(e)}return t.handleError(a)}}}(this),a.send(r)},n}(this.Architect.Worker)}.call(this),function(){var t={}.hasOwnProperty,r=function(r,e){function n(){this.constructor=r}for(var o in e)t.call(e,o)&&(r[o]=e[o]);return n.prototype=e.prototype,r.prototype=new n,r.__super__=e.prototype,r};this.Architect.JSONPWorker=function(t){function e(){e.__super__.constructor.call(this),window.jsonpID||(window.jsonpID=0)}return r(e,t),e.prototype.postMessage=function(t){var r,e;return e=document.createElement("script"),r="architect_jsonp"+ ++window.jsonpID,window[r]=function(t){return function(n){return delete window[r],document.head.removeChild(e),t.handleRequest(n)}}(this),e.src=this.appendQuery(t,"callback="+r),document.head.appendChild(e)},e.prototype.appendQuery=function(t,r){return(t+"&"+r).replace(/[&?]{1,2}/,"?")},e}(this.Architect.Worker)}.call(this),function(){var t={}.hasOwnProperty,r=function(r,e){function n(){this.constructor=r}for(var o in e)t.call(e,o)&&(r[o]=e[o]);return n.prototype=e.prototype,r.prototype=new n,r.__super__=e.prototype,r};this.Architect.ProxyWorker=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.postMessage=function(t){return this.handleRequest(t)},e}(this.Architect.Worker)}.call(this),function(){var t,r,e;this.Architect.SUPPORT_WORKER=!!window.Worker,this.Architect.WORKERS={proxy:{polyfill:this.Architect.ProxyWorker,workerPath:"architect/proxy_worker.min.js"},ajax:{polyfill:this.Architect.AjaxWorker,workerPath:"architect/ajax_worker.min.js"},jsonp:{polyfill:this.Architect.JSONPWorker,workerPath:"architect/jsonp_worker.min.js"}},t=function(t){return this.Architect.workersPath?""+this.Architect.workersPath+"/"+t+"_worker.min.js":this.Architect.WORKERS[t].workerPath},e=function(r){return this.Architect.SUPPORT_WORKER?new Worker(t(r)):new this.Architect.WORKERS[r].polyfill},this.Architect.setupWorkersPath=function(t){return function(r){return t.Architect.workersPath=r.replace(/\/$/,"")}}(this),this.Architect.work=function(t,r,n){var o;return o=e(r),o.postMessage(t),o.addEventListener("message",function(t){return o.terminate(),"function"==typeof n?n(t.data):void 0})},this.Architect.proxy=function(t){return function(r,e){return t.Architect.work(r,"proxy",e)}}(this),this.Architect.jsonp=function(t){return function(r,e){return t.Architect.work(r,"jsonp",e)}}(this),this.Architect.ajax=function(t){return function(r){var e,n;return n=r.success,e=r.error,delete r.success,delete r.error,t.Architect.work(r,"ajax",function(t){return"success"in t&&"function"==typeof n&&n(t.success),"error"in t?"function"==typeof e?e(t.error):void 0:void 0})}}(this),r={},this.Architect.workOn=function(t,n,o,c){var i,s;return this.workOnCallback=c,i=!!r[t],s=r[t]||(r[t]=e(o)),s.postMessage(n),i?void 0:s.addEventListener("message",function(t){return function(r){return"function"==typeof t.workOnCallback?t.workOnCallback(r.data):void 0}}(this))},this.Architect.endJob=function(t){var e;if(e=r[t])return e.terminate(),delete r[t]},this.Architect.proxyOn=function(t){return function(r,e,n){return t.Architect.workOn(r,e,"proxy",n)}}(this),this.Architect.ajaxOn=function(t){return function(r,e,n){return t.Architect.workOn(r,e,"ajax",n)}}(this),this.Architect.jsonpOn=function(t){return function(r,e,n){return t.Architect.workOn(r,e,"jsonp",n)}}(this),this.Architect.workFrom=function(t){return function(r,e,n,o){var c;return null==n&&(n=null),void 0===o&&(o=n,n=null),t.Architect.SUPPORT_WORKER?(c=new Worker(r),c.postMessage(e),c.addEventListener("message",function(t){return c.terminate(),"function"==typeof o?o(t.data):void 0})):n?"function"==typeof o?o(n(e)):void 0:console.warn("No fallback provided for "+r)}}(this)}.call(this);
